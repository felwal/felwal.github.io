{{ define "main" }}

    <article class="column">
        <!-- title -->
        {{ if .Title }}
            <h1>{{ .Title }}</h1>
        {{ else }}
            <h1>Unnamed</h1>
        {{ end }}

        {{ $format := "2006-01-02" }}

        {{ with .Params.summary }}
            <p><strong>{{ . }}</strong></p>
        {{ end }}

        <!-- images -->
        {{ range .Params.images }}
            {{ $path := printf "%s" . | printf "%s%s" "images/" | printf "%s" }}
            {{ $image := resources.Get $path }}

            {{ with $image }}
                {{ $thumb := .Resize "1500x webp" }}

                <a href="{{ $image.RelPermalink }}">
                    <img class="single-photo-image" src="{{ $thumb.RelPermalink }}" />
                </a>

                <!-- image metadata -->
                {{ with $image.Exif }}
                    <p class="caption">Taken {{ .Date | time.Format $format }}</p>
                {{ end }}
            {{ else }}
                {{ fmt.Warnf ( printf "%s" $path | printf "%s%s" "Single: unable to find " | printf "%s") }}
            {{ end }}
        {{ end }}

        <!-- dates -->
        {{ with .Params.published }}
            <p class="caption">Published {{ . | time.Format $format }}</p>
        {{ end }}
        {{ with .Params.modified }}
            {{ if ne . $.Params.published }}
                <p class="caption">Updated {{ . | time.Format $format }}</p>
            {{ end }}
        {{ end }}
        {{ with .Params.completed }}
            <p class="caption">Completed {{ . | time.Format $format }}</p>
        {{ end }}
        {{ with .Params.released }}
            <p class="caption">Released {{ . | time.Format $format }}</p>
        {{ end }}

        <!-- links -->
        {{ with .Params.links }}
            <p>Links:
            {{ range $i, $map := . }}
                {{ range $key, $val := $map }}
                    {{ partial "link-external.html" (dict "link" $val "text" $key) }}
                {{ end }}
            {{ end }}
            </p>
        {{ end }}

        <!-- taxonomies -->
        <p>
            {{ with index .Params.courses 0 }}
                Course: <a href="/courses/{{ . }}" class="link-tag">#{{ . }}</a>
            {{ end }}
            {{ with .Params.tags }}
                Tags:
                {{ range . }}
                    <a href="/tags/{{ . }}" class="link-tag">#{{ . }}</a>
                {{ end }}
            {{ end }}
            {{ with .Params.tools }}
                Tools:
                {{ range . }}
                    <a href="/tools/{{ . }}" class="link-tag">#{{ . }}</a>
                {{ end }}
            {{ end }}
            </p>

        {{ .Content }}

        <!-- related pages -->
        {{ with .Params.related }}
            <h2>Related</h2>

            {{ range . }}
                {{ partial "item_link" (site.GetPage .) }}
                <p />
            {{ end }}
        {{ end }}
    </article>

{{ end }}
