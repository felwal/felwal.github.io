{{ define "main" }}

    <article class="column">
        <!-- title -->
        {{ if .Title }}
            <h1>{{ .Title }}</h1>
        {{ else }}
            <h1>Unnamed</h1>
        {{ end }}

        {{ $format := "2006-01-02" }}

        {{ with .Params.summary }}
            <p class="summary">{{ . }}</p>
        {{ end }}

        {{ $dateTaken := "" }}

        <!-- banner(s) -->
        {{ range .Params.images }}
            {{ $path := partial "fn/Concat" (slice "images/" .) }}
            {{ $image := resources.Get $path }}

            {{ with $image }}
                {{ partial "single/image_banner" (dict "image" .) }}
                <p></p>

                <!-- image metadata -->
                {{ with .Exif }}
                    {{ $dateTaken = partial "fn/Concat" (slice "Taken " (.Date | time.Format $format)) }}
                {{ else }}
                    {{ fmt.Warnf (partial "fn/Concat" (slice "Single: no exif for " $path)) }}
                {{ end }}

            {{ else }}
                {{ fmt.Warnf (partial "fn/Concat" (slice "Single: unable to find " $path)) }}
            {{ end }}
        {{ end }}

        <!-- dates -->

        {{ $dates := slice }}

        {{ with partial "fn/GetProjectDuration" (dict "start" .Params.started "end" .Params.completed) }}
            {{ $dates = collections.Append . $dates }}
        {{ end }}

        {{ with .Params.released }}
            {{ $d := partial "fn/Concat" (slice "Released " (. | time.Format $format)) }}
            {{ $dates = collections.Append $d $dates }}
        {{ end }}

        {{ with .Params.published }}
            {{ $d := partial "fn/Concat" (slice "Published " (. | time.Format $format)) }}
            {{ $dates = collections.Append $d $dates }}
        {{ end }}

        {{ with .Params.modified }}
            {{ if ne . $.Params.published }}
                {{ $d := partial "fn/Concat" (slice "Updated " (. | time.Format $format)) }}
                {{ $dates = collections.Append $d $dates }}
            {{ end }}
        {{ end }}

        {{ with $dateTaken }}
            {{ $dates = collections.Append . $dates }}
        {{ end }}

        {{ $datesCaption := collections.Delimit $dates " Â· " }}
        <p class="caption">{{ $datesCaption }}</p>

        <p>
            <!-- links -->
            {{ with .Params.links }}
            Links:
                {{ range $i, $map := . }}
                    {{ range $key, $val := $map }}
                        {{ partial "p/link_external" (dict "link" $val "text" $key) }}
                    {{ end }}
                {{ end }}
            {{ end }}

            <!-- taxonomies -->
            {{ with .Params.series }}
                {{ partial "p/link_tag_list" (dict "taxonomy" "series" "list" . ) }}
            {{ end }}

            {{ with .Params.tags }}
                {{ partial "p/link_tag_list" (dict "taxonomy" "tags" "list" . ) }}
            {{ end }}

            {{ with .Params.tools }}
                {{ partial "p/link_tag_list" (dict "taxonomy" "tools" "list" . ) }}
            {{ end }}
        </p>

        {{ .Content }}

        <!-- related pages -->
        {{ with .Params.related }}
            <h2>Related</h2>

            {{ range . }}
                {{ partial "it/item_link" (site.GetPage .) }}
                <p />
            {{ end }}
        {{ end }}
    </article>

{{ end }}
